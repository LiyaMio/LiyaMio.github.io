<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxx-xx"></script>
    <script type="text/javascript">
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-xxxxxx-xx');
    </script>
  

  <!-- Baidu Tongji -->
  
    <script type="text/javascript">
      // Originial
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  <!-- Baidu Push -->
  
    <script>
      (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
      })();
    </script>
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc"/>
  <meta name="baidu-site-verification" content="PpzM9WxOJU"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Mioz&#39;s blog..."/>
  <meta name="keyword" content="life,go,livemylife,IT  blog,Blog"/>
  <link rel="shortcut icon" href="/img/avatar/clound.jpg"/>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- viewer start (Picture preview) -->
      <link rel="stylesheet" href="/css/viewer.min.css"/>
      <!-- viewer end -->
    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- gitalk start -->
      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->
      <link rel="stylesheet" href="/css/gitalk.css"/>
      <!-- gitalk end -->
    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="http://yoursite-url/paper/Agent/True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning/">
  <title>
    
      True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning - Ride or Die
    
  </title>
<meta name="generator" content="Hexo 5.4.0"></head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--dark">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'dark';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		
		<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'https://github.com/liyamio/liyamio.github.io.git'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Ride or Die</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">HOME</a>
          </li>

          
          
          
          
          <li>
            <a href="/archive/">
              
              ARCHIVES
              
              
            </a>
          </li>
          
          
          
          
          
          <li>
            <a href="/tags/">
              
              TAGS
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/categories/">
              
              CATEGORIES
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>SEARCH</a>
          </li>
          

          <!-- LangSelect -->
          
          
          
          
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: url('/img/header_img/lml_bg.jpg');
      --intro-header-background-image-url-page: url('//img/header_img/lml_bg.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/lml_bg.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('//img/header_img/lml_bg.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('/img/header_img/lml_bg.jpg'); */
      
    }

    
      #signature {/*signature*/
        background-image: url('/img/signature/liz.png');
      }
    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
              <a class="tag" href="/tags/#paper" title="paper">paper</a>
              
              <a class="tag" href="/tags/#Agent" title="Agent">Agent</a>
              
              <a class="tag" href="/tags/#WM" title="WM">WM</a>
              
            </div>
            <h1>True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning</h1>
            <h2 class="subheading"></h2>
            <span class="meta">
              Posted by 云起 on
              2025-03-06
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">19</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">5.2k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            
            <!-- 不蒜子统计 start -->
            <span class="meta" id="busuanzi_container_page_pv">
              Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
            </span>
            <!-- 不蒜子统计 end -->
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <p>[toc]</p>
<h1 id="discussion-and-conclusion"><a href="#DISCUSSION-AND-CONCLUSION" class="headerlink" title="DISCUSSION AND CONCLUSION"></a>DISCUSSION AND CONCLUSION</h1><p>TWOSOME:</p>
<ul>
<li>通过强化学习将LLMs与环境对齐，来解决决策任务，并且不需要任何准备的数据集或环境的先验知识，同时不会显著损失LLM的原始能力。</li>
<li>更可控、更可行、可解释性更强。</li>
<li>具有单词归一化，采样效率更高  。</li>
<li>泛化能力强。</li>
<li>计算量比较大，批处理规模较小。</li>
</ul>
<h1 id="introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><ul>
<li>大模型在简单决策任务上会失败，原因：<ul>
<li>LLM会产生无效动作。</li>
<li>LLM无法准确的知道环境的动态变化。</li>
</ul>
</li>
<li>TWOSOME：通过强化学习将LLMs与环境对齐</li>
<li>不让LLM直接生成动作，而是使用LLM提供的每个令牌的对数似然分数来计算每个动作的联合概率，并形成有效的行为策略。</li>
<li>最近策略优化（PPO）和环境奖励来优化LLM代理，消除动态转换导致的失调。</li>
<li>提出了基于代词数量和作用词数量的代词归一化和单词归一化来纠正较长的行动往往具有较低的联合概率，从而导致行动分布的不合理不平衡。</li>
</ul>
<h1 id="relatedwork"><a href="#RelatedWork" class="headerlink" title="RelatedWork"></a>RelatedWork</h1><h2 id="embodied-agents-with-llms"><a href="#Embodied-Agents-with-LLMs" class="headerlink" title="Embodied Agents with LLMs"></a>Embodied Agents with LLMs</h2><ul>
<li>过于依赖大模型的故有能力，很难应用到规模较小的模型上。</li>
<li>专注于玩具环境中的简单原始动作，没有丰富的语义，导致LLM的功能利用不足，并且未能观察到即时设计的影响，并解决动作空间上的不平衡。</li>
</ul>
<h2 id="finetuning-llms"><a href="#Finetuning-LLMs" class="headerlink" title="Finetuning LLMs"></a>Finetuning LLMs</h2><ul>
<li>使用监督学习，通过在环境中随机采样来微调具有预先收集的具体经验的LLM，而不是从头开始执行决策任务。</li>
</ul>
<h1 id="preliminaries"><a href="#Preliminaries" class="headerlink" title="Preliminaries"></a>Preliminaries</h1><ul>
<li><p>LLMs：使用无监督学习从文本数据中学习。</p>
<ul>
<li>将可变长度符号序列的联合概率优化为条件概率的乘积。</li>
<li>$$P (x) &#x3D;  \prod^n  <em>{i&#x3D;1} P (s_i|s_1, …, s</em>{i−1})$$</li>
</ul>
</li>
<li><p>LoRA：将可训练秩分解矩阵合并到LLM的每个层中的参数和计算高效微调方法。</p>
</li>
<li><p>RL：将决策问题表示为马尔可夫决策过程（MDP）。MDP由元组（S，A，T，R，γ）定义，其中S是状态空间，A是动作空间，T是状态转移概率，R是奖励函数，γ是折扣因子。智能体据观察结果选择行动，旨在最大化预期折扣累积奖励。</p>
</li>
<li><p>PPO：近端策略优化。通过限制策略更新幅度，使得每一步训练都不会偏离当前策略太多，同时高效利用采样数据。</p>
</li>
<li><p>Aligning LLMs with Embodied Environments：具体化环境中将LLM部署为交互式代理，其中LLM接收文本观察并生成在环境中执行的文本操作。</p>
</li>
</ul>
<h1 id="twosome"><a href="#TWOSOME" class="headerlink" title="TWOSOME"></a>TWOSOME</h1><h2 id="valid-policy-generation"><a href="#Valid-Policy-Generation" class="headerlink" title="Valid Policy Generation"></a>Valid Policy Generation</h2><ul>
<li><strong>行动提示（Action Prompt）</strong>：将每个行动与唯一语义提示关联，LLMs生成行动的概率，而非直接生成行动。</li>
<li><strong>策略形成</strong>：通过LLMs的词元概率计算行动的联合概率，并归一化为有效行为策略。</li>
</ul>
<p><strong>公式（1）</strong>：计算行动的联合概率</p>
<p>![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;公式（1）.png)</p>
<p><strong>解释：</strong></p>
<ul>
<li>$a_k$ 是一个行动，由一系列词元（tokens）组成，即$a_k$ &#x3D;$${w_1^k,w_2^k,…,w_{N_k}^k}$$。</li>
<li><em>s</em> 是当前的观察状态。</li>
<li>$$P_{token}(a_k∣s)$$ 是行动 $a_k$ 在状态 <em>s</em> 下的联合概率。</li>
<li>$$P(w_i^k∣s,w_1^k,…,w_{i−1}^k)$$ 是在状态 <em>s</em> 和已生成词元 $$w_1^k,…,w_{i−1}^k$$  的条件下，生成词元 $$w_i^k$$ 的概率。</li>
<li>假设行动 $$a_k$$ 是 “pick up the tomato”，由词元 {pick, up, the, tomato} 组成，那么联合概率为：</li>
</ul>
<p><strong>公式（2）</strong>：归一化行动概率</p>
<p>![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;公式（2）.png)</p>
<p><strong>解释：</strong></p>
<ul>
<li>$$P(a_k∣s)$$ 是行动 $$a_k$$ 在状态 <em>s</em> 下的归一化概率。</li>
<li>$$exp(log P_{token}(a_k∣s))$$ 是联合概率$$P_{token}(a_k∣s))$$的指数形式。</li>
<li>分母是所有可能行动的指数形式联合概率之和，用于归一化。</li>
</ul>
<p><strong>示例：</strong> 假设在状态 <em>s</em> 下，有两个行动 $$a_1$$ 和 $$a_2$$，它们的联合概率分别为 $$P_{token}(a_1∣s)&#x3D;0.05$$ 和 $$P_{token}(a_2∣s)&#x3D;0.15$$，那么归一化后的概率为：</p>
<p>$$P(a_1∣s)&#x3D;\frac{exp(log0.05)}{exp(log0.05)+exp(log0.15)}&#x3D;\frac{0.05}{0.05+0.15}&#x3D;0.25$$</p>
<p>$$P(a_2∣s)&#x3D;\frac{exp(log0.15)}{exp(log0.05)+exp(log0.15)}&#x3D;\frac{0.15}{0.05+0.15}&#x3D;0.75$$</p>
<p>通过归一化，确保了所有行动的概率之和为1，便于策略的选择和比较。</p>
<h2 id="action-prompt-normalization"><a href="#ACTION-PROMPT-NORMALIZATION" class="headerlink" title="ACTION PROMPT NORMALIZATION"></a>ACTION PROMPT NORMALIZATION</h2><ul>
<li><p><strong>公式（1）存在问题</strong>：行动提示（action prompts）的长度差异会导致联合概率（joint probabilities）计算中的不平衡问题。具体来说，较长的行动提示倾向于具有较低的联合概率，即使它们在实际环境中是更合理的行动。这种不平衡会影响策略的稳定性和训练效率</p>
</li>
<li><p>解决：</p>
<ul>
<li><p>Token  Normalization（词元归一化）</p>
<ul>
<li>通过将每个行动提示的联合概率除以该行动提示的词元数（tokens）来调整概率分布。具体公式如下：![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;公式（3）.png)<ul>
<li>$$P_{tn}(a_k∣s)$$ 是归一化后的概率。</li>
<li>$$P_{token}(a_k∣s)$$ 是原始的联合概率。</li>
<li>$$N_k$$ 是行动提示 $$a_k$$ 的词元数。</li>
<li>通过词元归一化，较长的行动提示的联合概率会被调整到与较短的行动提示相同的量级，从而避免因为词元数量不同而导致的不平衡。</li>
</ul>
</li>
</ul>
</li>
<li><p>Word Normalization（词归一化）</p>
<ul>
<li><p>词归一化通过将每个行动提示的联合概率除以该行动提示的词数（words）来调整概率分布。![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;公式（4）.png)</p>
</li>
<li><p>$$P_{tn}(a_k∣s)$$ 是归一化后的概率。</p>
</li>
<li><p>$$P_{token}(a_k∣s)$$ 是原始的联合概率。</p>
</li>
<li><p>$$W_k$$ 是行动提示 $$a_k$$ 的词数。</p>
</li>
<li><p>与词元归一化类似，词归一化也通过调整概率分布来避免因为词数不同而导致的不平衡。词归一化更适合处理那些由多个词组成的行动提示，因为它考虑了词的实际数量而不是词元数量。</p>
</li>
</ul>
</li>
<li><p>Comparing the Two Normalizations：</p>
</li>
<li><table>
<thead>
<tr>
<th align="left"><strong>对比维度</strong></th>
<th align="left"><strong>词元归一化（Token Normalization）</strong></th>
<th align="left"><strong>词归一化（Word Normalization）</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>定义</strong></td>
<td align="left">基于词元数量的归一化</td>
<td align="left">基于词数量的归一化</td>
</tr>
<tr>
<td align="left"><strong>优点</strong></td>
<td align="left">简单直接，有效调整</td>
<td align="left">更符合语言习惯，更好平衡</td>
</tr>
<tr>
<td align="left"><strong>缺点</strong></td>
<td align="left">过度归一化，对词元数量敏感</td>
<td align="left">计算稍复杂，对词数敏感</td>
</tr>
<tr>
<td align="left"><strong>实验表现</strong></td>
<td align="left">在某些任务中表现较好，但收敛速度可能较慢</td>
<td align="left">在大多数任务中表现更好，收敛更快</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<h2 id="parameter-efficient-ppo-finetuning"><a href="#Parameter-Efficient-PPO-Finetuning" class="headerlink" title="Parameter-Efficient PPO Finetuning"></a>Parameter-Efficient PPO Finetuning</h2><h3 id="architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p>![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;F3.png)</p>
<ul>
<li><strong>冻结的LLaMA-7B模型</strong>：<ul>
<li>LLaMA-7B模型是整个架构的基础，其参数在训练过程中保持冻结，不进行更新。</li>
<li>这部分模型负责生成文本表示，为后续的策略优化提供基础。</li>
</ul>
</li>
<li><strong>额外的MLP层</strong>：<ul>
<li>在冻结的LLaMA-7B模型的最后一个Transformer块之后，添加了一个额外的多层感知器（MLP）网络，用作批评家（critic）。</li>
<li>批评家的MLP网络的输入是观察提示的最后一个词元，输出是对当前观察提示的估值（value）。</li>
</ul>
</li>
<li><strong>LoRA适配器</strong>：<ul>
<li>在冻结的LLaMA-7B模型中，添加了低秩适配器（LoRA）进行参数化微调。</li>
<li>LoRA通过引入低秩矩阵来近似参数更新，从而减少需要优化的参数数量，提高训练效率。</li>
</ul>
</li>
<li><strong>动作和价值输出</strong>：<ul>
<li><strong>动作输出</strong>：冻结的LLaMA-7B模型与LoRA适配器结合，生成动作概率。</li>
<li><strong>价值输出</strong>：额外的MLP网络生成当前状态的价值估计。</li>
</ul>
</li>
</ul>
<h3 id="training"><a href="#Training" class="headerlink" title="Training"></a>Training</h3><h5 id="环境交互"><a href="#环境交互" class="headerlink" title="环境交互"></a>环境交互</h5><ul>
<li><strong>观察提示</strong>：环境提供观察提示（obs prompt）和奖励（reward）信号。</li>
<li><strong>动作输出</strong>：冻结的LLaMA-7B模型与LoRA适配器结合，生成动作概率。</li>
</ul>
<h5 id="策略优化"><a href="#策略优化" class="headerlink" title="策略优化"></a>策略优化</h5><ul>
<li><strong>PPO算法</strong>：基于累积奖励（advantage）进行优化。</li>
<li><strong>优势函数</strong>：<em>A</em>(<em>st,<em>at)&#x3D;<em>Q</em>(<em>st</em>,<em>at</em>)−</em>V</em>(<em>st</em>)，其中<em>Q</em>(<em>st</em>,<em>at</em>)是动作值函数，<em>V</em>(<em>st</em>)是价值函数。</li>
<li><strong>目标函数</strong>：PPO目标函数确保策略更新的一致性和稳定性。</li>
</ul>
<h5 id="价值网络优化"><a href="#价值网络优化" class="headerlink" title="价值网络优化"></a>价值网络优化</h5><ul>
<li><strong>损失函数</strong>：最小化价值函数的均方误差（MSE）。</li>
<li><strong>优化器</strong>：使用Adam优化器。</li>
</ul>
<h2 id="prompt-design"><a href="#Prompt-Design" class="headerlink" title="Prompt Design"></a>Prompt Design</h2><p>四个原则</p>
<ol>
<li><strong>提示的连贯性</strong>：<ul>
<li><strong>定义</strong>：观察提示和行动提示应具有连贯性，便于LLMs理解和生成合理的行动。</li>
<li><strong>具体做法</strong>：观察提示以“you should”结尾，行动提示以“next step is to”开头，确保提示之间的逻辑连贯性。</li>
<li><strong>示例</strong>：<ul>
<li>观察提示：You see a tomato, a bowl and a cutting board. To make a tomato salad, you should</li>
<li>行动提示：pick up the tomato, take the bowl, move to the cutting board, chop the tomato, serve the dish</li>
</ul>
</li>
</ul>
</li>
<li><strong>冠词的敏感性</strong>：<ul>
<li><strong>定义</strong>：LLMs对冠词（如“the”、“a”、“an”）非常敏感，提示中应包含适当的冠词以提高LLMs的识别率。</li>
<li><strong>具体做法</strong>：在行动提示中明确包含冠词，如“pick up the tomato”而不是“pick up tomato”。</li>
<li><strong>示例</strong>：<ul>
<li>正确提示：pick up the tomato</li>
<li>错误提示：pick up tomato</li>
</ul>
</li>
</ul>
</li>
<li><strong>重复词强化概率</strong>：<ul>
<li><strong>定义</strong>：通过在观察提示中重复关键名词，可以提高这些词在LLMs生成中的概率。</li>
<li><strong>具体做法</strong>：在观察提示中多次提及任务相关的关键名词，如“tomato”、“lettuce”等。</li>
<li><strong>示例</strong>：<ul>
<li>观察提示：You see a tomato on the table. Your task is to make a salad consisting of tomato.</li>
</ul>
</li>
</ul>
</li>
<li><strong>行动语境适配</strong>：<ul>
<li><strong>定义</strong>：根据环境状态设计行动提示，确保行动的合理性和环境适配性。</li>
<li><strong>具体做法</strong>：根据当前环境状态和任务目标，设计与环境状态相匹配的行动提示。</li>
<li><strong>示例</strong>：<ul>
<li>当前状态：Agent is in the kitchen, holding a tomato.</li>
<li>行动提示：move to the cutting board, chop the tomato</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a>Experiments</h1><h2 id="setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><p>环境：</p>
<ul>
<li><strong>Overcooked</strong>：这是一个经典的决策环境，任务是制作番茄沙拉和番茄生菜沙拉。</li>
<li><strong>VirtualHome</strong>：这是一个模拟的家庭环境，任务包括加热煎饼和娱乐（准备零食、看电视）。</li>
</ul>
<p>方法：</p>
<ul>
<li><strong>PPO</strong>：传统的强化学习方法。</li>
<li><strong>TWOSOME without finetuning</strong>：类似于 SayCan 的方法，不进行微调。</li>
<li><strong>TWOSOME without normalization</strong>：不使用归一化。</li>
<li><strong>TWOSOME with token normalization</strong>：使用词元归一化。</li>
<li><strong>TWOSOME with word normalization</strong>：使用词归一化。</li>
</ul>
<h5 id="超参数"><a href="#超参数" class="headerlink" title="超参数"></a>超参数</h5><ul>
<li><strong>网络架构</strong>：冻结的 LLaMA-7B 模型，添加 LoRA 适配器和 MLP 批评家网络。</li>
<li><strong>训练设置</strong>：使用半精度浮点数（float16），训练和测试在单个 NVIDIA Tesla A100 和 NVIDIA RTX A6000 GPU 上完成。</li>
</ul>
<h2 id="the-impact-of-different-normalizations-in-twosome"><a href="#The-impact-of-different-Normalizations-in-TWOSOME" class="headerlink" title="The impact of different Normalizations in TWOSOME"></a>The impact of different Normalizations in TWOSOME</h2><p>图5a</p>
<p>![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;F5.png)</p>
<ul>
<li><strong>TWOSOME with word normalization</strong>：在所有任务中表现出最佳性能，成功率达到 100%。</li>
<li><strong>TWOSOME without normalization</strong>：在某些任务中表现不稳定，尤其是在行动提示长度差异较大的情况下。</li>
<li><strong>TWOSOME with token normalization</strong>：虽然提高了稳定性，但在收敛速度上不如词归一化。</li>
</ul>
<h2 id="twosome-vs-baselines"><a href="#TWOSOME-vs-Baselines" class="headerlink" title="TWOSOME vs Baselines"></a>TWOSOME vs Baselines</h2><p>图5b</p>
<p>与 SayCan（baseline） 的对比</p>
<ul>
<li><strong>Overcooked 环境</strong>：<ul>
<li><strong>番茄沙拉任务</strong>：TWOSOME without finetuning 的成功率为 0.36 ± 0.04，而 TWOSOME with word normalization 的成功率为 1 ± 0。</li>
<li><strong>番茄生菜沙拉任务</strong>：TWOSOME without finetuning 的成功率为 0 ± 0，而 TWOSOME with word normalization 的成功率为 1 ± 0。</li>
</ul>
</li>
<li><strong>VirtualHome 环境</strong>：<ul>
<li><strong>加热煎饼任务</strong>：TWOSOME without finetuning 的成功率为 0.81 ± 0.01，而 TWOSOME with word normalization 的成功率为 1 ± 0。</li>
<li><strong>娱乐任务</strong>：TWOSOME without finetuning 的成功率为 0.45 ± 0.05，而 TWOSOME with word normalization 的成功率为 1 ± 0。</li>
</ul>
</li>
</ul>
<p>与PPO相比</p>
<ul>
<li><strong>Overcooked 环境</strong>：<ul>
<li><strong>番茄沙拉任务</strong>：PPO 需要 5e5 步才能收敛，而 TWOSOME with word normalization 在更少的步数内达到更高的成功率。</li>
<li><strong>番茄生菜沙拉任务</strong>：PPO 需要 5e5 步才能收敛，而 TWOSOME with word normalization 在更少的步数内达到更高的成功率。</li>
</ul>
</li>
<li><strong>VirtualHome 环境</strong>：<ul>
<li><strong>加热煎饼任务</strong>：PPO 需要 5e4 步才能收敛，而 TWOSOME with word normalization 在更少的步数内达到更高的成功率。</li>
<li><strong>娱乐任务</strong>：PPO 需要 2e5 步才能收敛，而 TWOSOME with word normalization 在更少的步数内达到更高的成功率。</li>
</ul>
</li>
</ul>
<h2 id="open-vocabulary-task-generalzation"><a href="#Open-vocabulary-Task-Generalzation" class="headerlink" title="Open-vocabulary Task Generalzation"></a>Open-vocabulary Task Generalzation</h2><p>![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;F6.png)</p>
<p>我们在八个新的未见过的任务中评估了 TWOSOME 的泛化能力，这些任务包括：</p>
<ul>
<li><strong>Cheese</strong>、<strong>Hamburger</strong>、<strong>Apple Pie</strong>、<strong>Pizza</strong>：替换原始任务中的食物。</li>
<li><strong>Washing Plate</strong>、<strong>Laundry</strong>：更复杂的任务，需要多步操作。</li>
<li><strong>Food Preparation</strong> 和 <strong>Entertainment</strong> 的交叉测试。</li>
</ul>
<p> 实验结果</p>
<ul>
<li><strong>TWOSOME with word normalization</strong>：在所有八个任务中都表现出色，成功率达到 100%。</li>
<li><strong>SayCan</strong>：在某些任务中表现较差，尤其是在需要复杂操作的任务中。</li>
</ul>
<h2 id="impact-of-online-finetuning"><a href="#Impact-of-Online-Finetuning" class="headerlink" title="Impact of Online Finetuning"></a>Impact of Online Finetuning</h2><p>![](True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&#x2F;T1.png)</p>
<p>我们在 VirtualHome 任务中评估了在线 PPO 微调对 LLMs 能力的影响</p>
<ul>
<li><strong>评估基准</strong>：使用广泛使用的 NLP 基准（Gao et al., 2021）。</li>
<li><strong>模型</strong>：评估了 TWOSOME with word normalization 在 Food Preparation 和 Entertainment 任务中的表现。</li>
</ul>
<p>结果</p>
<ul>
<li><strong>零样本性能</strong>：TWOSOME with word normalization 在 ARC_C、HellaSwag 和 PIQA 任务中的零样本性能与原始 LLaMA 模型相当，甚至在某些任务中略有提升。</li>
<li><strong>MMLU 任务</strong>：在大多数子任务中，TWOSOME with word normalization 的性能与原始 LLaMA 模型相当，某些子任务中略有下降。</li>
</ul>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul>
<li><strong>TWOSOME with word normalization</strong> 在所有任务中表现出最佳性能，成功率达到 100%。</li>
<li><strong>TWOSOME</strong> 框架显著提高了样本效率和性能，优于传统的 RL 方法和提示微调方法。</li>
<li><strong>TWOSOME</strong> 具有良好的泛化能力，能够将学到的技能迁移到未见过的任务。</li>
</ul>
<p>局限性</p>
<ul>
<li><strong>计算成本</strong>：TWOSOME 需要为每次行动采样向 LLMs 提供所有有效行动，导致计算量和时间成本增加。</li>
<li><strong>训练稳定性</strong>：在某些情况下，训练过程可能会出现不稳定，需要 careful 的超参数调整。</li>
</ul>
<h1 id="创新点"><a href="#创新点" class="headerlink" title="创新点"></a>创新点</h1><ol>
<li><strong>高效策略生成</strong>：TWOSOME通过查询LLMs的分数来确定行动的概率，而不是直接生成行动，确保了策略的有效性和环境适配性。这种方法不仅避免了LLMs生成无效行动的问题，还充分利用了LLMs的语言理解和生成能力。</li>
<li><strong>行动提示归一化</strong>：为了解决行动提示长度差异导致的概率不平衡问题，TWOSOME提出了词元归一化和词归一化技术。这些技术通过调整概率分布，避免了因为词元或词数不同而导致的不平衡，显著提高了训练的稳定性和收敛速度。</li>
<li><strong>参数化PPO微调</strong>：TWOSOME通过冻结LLaMA-7B模型并使用低秩适配器（LoRA）进行参数化微调，减少了需要优化的参数数量，提高了训练效率。同时，通过添加额外的MLP层作为批评家网络，结合PPO算法进行策略优化，确保了训练的稳定性和快速收敛。</li>
<li><strong>提示设计原则</strong>：文章总结了四个提示设计原则，包括提示的连贯性、冠词的敏感性、重复词强化概率和行动语境适配。这些原则通过精心设计的提示，显著提高了LLMs的决策能力和泛化能力。</li>
</ol>
<h1 id="优化策略"><a href="#优化策略" class="headerlink" title="优化策略"></a>优化策略</h1><h2 id="计算效率"><a href="#计算效率" class="headerlink" title="计算效率"></a>计算效率</h2><p>针对TWOSOME框架的计算效率优化，可以从以下几个方面进行改进：</p>
<h3 id="1-高效采样策略"><a href="#1-高效采样策略" class="headerlink" title="1. 高效采样策略"></a>1. 高效采样策略</h3><p><strong>问题分析</strong>：TWOSOME需要为每次行动采样向LLMs提供所有有效行动，导致计算量和时间成本增加。<br><strong>改进方法</strong>：</p>
<ul>
<li><strong>基于优先级的采样</strong>：根据行动的历史成功率或相关性，为行动分配优先级。在每次采样时，优先选择高优先级的行动进行评估，减少低优先级行动的采样频率。</li>
<li><strong>分层采样</strong>：将行动按照类型或功能进行分组，形成层次结构。在采样时，先从高层类别中选择，再逐步细化到具体行动，减少每次采样需要评估的行动数量。</li>
<li><strong>行动过滤</strong>：在采样前，通过简单的规则或启发式方法过滤掉明显不合理的行动，减少需要评估的行动范围。</li>
</ul>
<h3 id="2-模型压缩"><a href="#2-模型压缩" class="headerlink" title="2. 模型压缩"></a>2. 模型压缩</h3><p><strong>问题分析</strong>：大型语言模型（LLMs）的参数量巨大，导致计算和存储成本高。<br><strong>改进方法</strong>：</p>
<ul>
<li><strong>剪枝</strong>：去除模型中不重要的连接或神经元，减少参数数量。可以通过分析权重的重要性，删除那些对模型输出影响较小的连接。</li>
<li><strong>量化</strong>：将模型的权重从高精度表示转换为低精度表示（如从32位浮点数转换为8位整数），减少存储需求和计算复杂度。</li>
<li><strong>知识蒸馏</strong>：训练一个较小的学生模型来模仿大型教师模型的行为，通过保留主要功能的同时减少参数量。</li>
</ul>
<h3 id="3-硬件加速"><a href="#3-硬件加速" class="headerlink" title="3. 硬件加速"></a>3. 硬件加速</h3><p><strong>问题分析</strong>：计算资源的限制影响了训练和推理的速度。<br><strong>改进方法</strong>：</p>
<ul>
<li><strong>GPU优化</strong>：利用GPU的并行计算能力，优化模型的计算过程。可以通过使用CUDA等并行计算框架，加速矩阵运算和神经网络的前向、反向传播。</li>
<li><strong>分布式计算</strong>：将计算任务分布在多个GPU或计算节点上，实现并行训练和推理。可以通过数据并行或模型并行的方式，提高计算效率。</li>
<li><strong>专用硬件</strong>：利用专用的AI加速硬件，如TPU，进一步提升计算速度和能效。</li>
</ul>
<h3 id="4-优化算法改进"><a href="#4-优化算法改进" class="headerlink" title="4. 优化算法改进"></a>4. 优化算法改进</h3><p><strong>问题分析</strong>：现有的优化算法可能不是最高效的，导致训练过程缓慢。<br><strong>改进方法</strong>：</p>
<ul>
<li><strong>自适应优化算法</strong>：使用更先进的自适应优化算法，如AdamW、RAdam等，这些算法能够自动调整学习率，提高收敛速度和稳定性。</li>
<li><strong>混合精度训练</strong>：结合不同精度的数值表示进行训练，如在前向传播中使用较低精度，反向传播中使用较高精度，减少计算资源的消耗同时保持模型的准确性。</li>
<li><strong>异步更新</strong>：采用异步更新机制，允许多个计算单元同时进行计算并异步更新模型参数，提高资源利用率和训练速度。</li>
</ul>
<h3 id="5-动态计算资源分配"><a href="#5-动态计算资源分配" class="headerlink" title="5. 动态计算资源分配"></a>5. 动态计算资源分配</h3><p><strong>问题分析</strong>：在不同的训练阶段或任务中，计算资源的需求可能不同。<br><strong>改进方法</strong>：</p>
<ul>
<li><strong>资源调度算法</strong>：开发智能的资源调度算法，根据任务的复杂度和当前的训练进度，动态分配计算资源。在任务初期或复杂任务中分配更多资源，在任务后期或简单任务中减少资源分配。</li>
<li><strong>弹性扩展</strong>：利用云计算等资源弹性扩展的特性，在需要时自动增加计算资源，在任务完成后释放资源，降低成本。</li>
<li><strong>优先级调整</strong>：根据任务的重要性和紧急程度，动态调整任务的优先级，合理分配计算资源，确保关键任务得到足够的资源支持。</li>
</ul>
<p>通过这些改进方法，可以有效提高TWOSOME框架的计算效率，减少计算资源的消耗，同时保持模型的性能和效果。这将使TWOSOME在实际应用中更具可行性和竞争力。</p>
<h2 id="其他优化"><a href="#其他优化" class="headerlink" title="其他优化"></a>其他优化</h2><h3 id="训练稳定性提升"><a href="#训练稳定性提升" class="headerlink" title="训练稳定性提升"></a><strong>训练稳定性提升</strong></h3><ul>
<li><strong>问题</strong>：在某些情况下，训练过程可能会出现不稳定，需要谨慎的超参数调整。</li>
<li><strong>改进方向</strong>：<ul>
<li><strong>自适应学习率</strong>：引入自适应学习率调整机制，根据训练过程中的反馈动态调整学习率，提高训练稳定性。</li>
<li><strong>正则化技术</strong>：增加更多的正则化技术，如dropout、权重衰减等，防止过拟合，提高模型的泛化能力。</li>
<li><strong>多任务学习</strong>：引入多任务学习框架，通过同时优化多个相关任务，提高模型的稳定性和鲁棒性。</li>
</ul>
</li>
</ul>
<h3 id="3-提示设计自动化"><a href="#3-提示设计自动化" class="headerlink" title="3. 提示设计自动化"></a>3. <strong>提示设计自动化</strong></h3><ul>
<li><strong>问题</strong>：当前的提示设计依赖于人工总结的原则，可能不够灵活和全面。</li>
<li><strong>改进方向</strong>：<ul>
<li><strong>自动提示生成</strong>：开发自动化的提示生成工具，能够根据任务和环境自动生成优化的提示。</li>
<li><strong>强化学习优化提示</strong>：使用强化学习方法优化提示设计，通过环境反馈自动调整提示内容。</li>
<li><strong>提示效果评估</strong>：建立提示效果的量化评估指标，能够自动评估和筛选出最优的提示设计。</li>
</ul>
</li>
</ul>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/leetcode/2597.统计美丽子集数目/" data-toggle="tooltip" data-placement="top" title="2597.统计美丽子集数目">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/leetcode/2588.统计美丽子数组数目/" data-toggle="tooltip" data-placement="top" title="2588.统计美丽子数组数目">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      If you like this blog or find it useful for you, you are welcome to comment on it. You are also welcome to share this blog, so that more people can participate in it. If the images used in the blog infringe your copyright, please contact the author to delete them. Thank you !
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning&body=Hi,I found this website and thought you might like it http://yoursite-url/paper/Agent/True Knowledge Comes from Practice Aligning LLMs with Embodied Environments via Reinforcement Learning/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->

  <!-- gitalk start -->
  <!-- Docs:https://github.com/gitalk/gitalk/blob/master/readme-cn.md -->

  <div id="gitalk-container"></div>

  
    <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.js"></script> -->
    <script src="/js/comment/gitalk.js"></script>
  

  <script>
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: '',
      admin: '',
      id: 'Thu Mar 06 2025 08:50:48 GMT+0800', // Ensure uniqueness and length less than 50
      distractionFreeMode: false, // Facebook-like distraction free mode
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: false,
      language: 'en',
      proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token'
    });
    gitalk.render('gitalk-container');

    var gtFolded = () => {
      setTimeout(function () {
        let markdownBody = document.getElementsByClassName("markdown-body");
        let list = Array.from(markdownBody);
        list.forEach(item => {
          if (item.clientHeight > 250) {
            item.classList.add('gt-comment-body-folded');
            item.style.maxHeight = '250px';
            item.title = 'Click to Expand';
            item.onclick = function () {
              item.classList.remove('gt-comment-body-folded');
              item.style.maxHeight = '';
              item.title = '';
              item.onclick = null;
            };
          }
        })
      }, 800);
    }
  </script>

  <!-- gitalk end -->


<!-- 2. gitment comment -->


<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#discussion-and-conclusion"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">DISCUSSION AND CONCLUSION</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#introduction"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">Introduction</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#relatedwork"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">RelatedWork</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#embodied-agents-with-llms"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">Embodied Agents with LLMs</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#finetuning-llms"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">Finetuning LLMs</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#preliminaries"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">Preliminaries</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#twosome"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">TWOSOME</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#valid-policy-generation"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">Valid Policy Generation</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#action-prompt-normalization"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">ACTION PROMPT NORMALIZATION</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#parameter-efficient-ppo-finetuning"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">Parameter-Efficient PPO Finetuning</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#architecture"><span class="toc-nav-number">5.3.1.</span> <span class="toc-nav-text">Architecture</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#training"><span class="toc-nav-number">5.3.2.</span> <span class="toc-nav-text">Training</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E7%8E%AF%E5%A2%83%E4%BA%A4%E4%BA%92"><span class="toc-nav-number">5.3.2.0.1.</span> <span class="toc-nav-text">环境交互</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96"><span class="toc-nav-number">5.3.2.0.2.</span> <span class="toc-nav-text">策略优化</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E4%BB%B7%E5%80%BC%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96"><span class="toc-nav-number">5.3.2.0.3.</span> <span class="toc-nav-text">价值网络优化</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#prompt-design"><span class="toc-nav-number">5.4.</span> <span class="toc-nav-text">Prompt Design</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#experiments"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">Experiments</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#setup"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">Setup</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E8%B6%85%E5%8F%82%E6%95%B0"><span class="toc-nav-number">6.1.0.0.1.</span> <span class="toc-nav-text">超参数</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#the-impact-of-different-normalizations-in-twosome"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">The impact of different Normalizations in TWOSOME</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#twosome-vs-baselines"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">TWOSOME vs Baselines</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#open-vocabulary-task-generalzation"><span class="toc-nav-number">6.4.</span> <span class="toc-nav-text">Open-vocabulary Task Generalzation</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#impact-of-online-finetuning"><span class="toc-nav-number">6.5.</span> <span class="toc-nav-text">Impact of Online Finetuning</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-nav-number">6.6.</span> <span class="toc-nav-text">结论</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E5%88%9B%E6%96%B0%E7%82%B9"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">创新点</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">优化策略</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E8%AE%A1%E7%AE%97%E6%95%88%E7%8E%87"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">计算效率</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E9%AB%98%E6%95%88%E9%87%87%E6%A0%B7%E7%AD%96%E7%95%A5"><span class="toc-nav-number">8.1.1.</span> <span class="toc-nav-text">1. 高效采样策略</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9"><span class="toc-nav-number">8.1.2.</span> <span class="toc-nav-text">2. 模型压缩</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F"><span class="toc-nav-number">8.1.3.</span> <span class="toc-nav-text">3. 硬件加速</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95%E6%94%B9%E8%BF%9B"><span class="toc-nav-number">8.1.4.</span> <span class="toc-nav-text">4. 优化算法改进</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-%E5%8A%A8%E6%80%81%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D"><span class="toc-nav-number">8.1.5.</span> <span class="toc-nav-text">5. 动态计算资源分配</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96"><span class="toc-nav-number">8.2.</span> <span class="toc-nav-text">其他优化</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E8%AE%AD%E7%BB%83%E7%A8%B3%E5%AE%9A%E6%80%A7%E6%8F%90%E5%8D%87"><span class="toc-nav-number">8.2.1.</span> <span class="toc-nav-text">训练稳定性提升</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E6%8F%90%E7%A4%BA%E8%AE%BE%E8%AE%A1%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-nav-number">8.2.2.</span> <span class="toc-nav-text">3. 提示设计自动化</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    



      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">FEATURED TAGS</a>
          </h5>
          <div class="tags">
            
            <a class="tag" href="/tags/#paper" title="paper">paper</a>
            
            <a class="tag" href="/tags/#Agent" title="Agent">Agent</a>
            
            <a class="tag" href="/tags/#WM" title="WM">WM</a>
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>FRIENDS</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://v-vincen.life/" target="_blank">V_Vincen</a>
          </li>
          
          <li>
            <a href="https://syvy.top/" target="_blank">SYVY</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/LiyaMio">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          
            <li>
              <a target="_blank" href="https://twitter.com/LiyaMio">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          云起
          2025
          <br>
          Theme by
          <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          re-Ported by
          <a target="_blank" rel="noopener" href="https://v-vincen.life/">Live My Life</a>
          |
          <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe>
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  
    <!-- Busuanzi JavaScript -->
    <script async="async" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  
    <!-- LangSelect start -->
    <script type="text/javascript" src="/js/langselect.js"></script>
    <!-- LangSelect end -->
  

  
    <!-- Mouseclick -->
    <script type="text/javascript" src="/js/mouseclick.js" content='The first step is as good as half over...,Laugh and grow fat...,Man proposes God disposes...,When all else is lost the future still remains...,Wasting time is robbing oneself...,Sharp tools make good work...,Cease to struggle and you cease to live...,A friend in need is a friend indeed...,Faith can move mountains...' color='#9933CC,#339933,#66CCCC,#FF99CC,#CCCCFF,#6666CC,#663399,#66CC99,#FF0033'></script>
  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  






  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  
    <script async="async" type="text/javascript" src="/js/viewer/viewer.min.js"></script>
    <script async="async" type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  

  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("http://yoursite-url/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="SEARCH..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
